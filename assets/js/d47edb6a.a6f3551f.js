"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[8394],{5162:(e,t,a)=>{a.d(t,{Z:()=>o});var s=a(7294),n=a(6010);const l="tabItem_Ymn6";function o(e){let{children:t,hidden:a,className:o}=e;return s.createElement("div",{role:"tabpanel",className:(0,n.Z)(l,o),hidden:a},t)}},5488:(e,t,a)=>{a.d(t,{Z:()=>m});var s=a(7462),n=a(7294),l=a(6010),o=a(2389),r=a(7392),i=a(7094),d=a(2466);const p="tabList__CuJ",u="tabItem_LNqP";function g(e){var t;const{lazy:a,block:o,defaultValue:g,values:m,groupId:c,className:b}=e,h=n.Children.map(e.children,(e=>{if((0,n.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),k=m??h.map((e=>{let{props:{value:t,label:a,attributes:s}}=e;return{value:t,label:a,attributes:s}})),y=(0,r.l)(k,((e,t)=>e.value===t.value));if(y.length>0)throw new Error(`Docusaurus error: Duplicate values "${y.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);const v=null===g?g:g??(null==(t=h.find((e=>e.props.default)))?void 0:t.props.value)??h[0].props.value;if(null!==v&&!k.some((e=>e.value===v)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${v}" but none of its children has the corresponding value. Available values are: ${k.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:f,setTabGroupChoices:D}=(0,i.U)(),[P,B]=(0,n.useState)(v),T=[],{blockElementScrollPositionUntilNextRender:N}=(0,d.o5)();if(null!=c){const e=f[c];null!=e&&e!==P&&k.some((t=>t.value===e))&&B(e)}const x=e=>{const t=e.currentTarget,a=T.indexOf(t),s=k[a].value;s!==P&&(N(t),B(s),null!=c&&D(c,String(s)))},S=e=>{var t;let a=null;switch(e.key){case"Enter":x(e);break;case"ArrowRight":{const t=T.indexOf(e.currentTarget)+1;a=T[t]??T[0];break}case"ArrowLeft":{const t=T.indexOf(e.currentTarget)-1;a=T[t]??T[T.length-1];break}}null==(t=a)||t.focus()};return n.createElement("div",{className:(0,l.Z)("tabs-container",p)},n.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,l.Z)("tabs",{"tabs--block":o},b)},k.map((e=>{let{value:t,label:a,attributes:o}=e;return n.createElement("li",(0,s.Z)({role:"tab",tabIndex:P===t?0:-1,"aria-selected":P===t,key:t,ref:e=>T.push(e),onKeyDown:S,onClick:x},o,{className:(0,l.Z)("tabs__item",u,null==o?void 0:o.className,{"tabs__item--active":P===t})}),a??t)}))),a?(0,n.cloneElement)(h.filter((e=>e.props.value===P))[0],{className:"margin-top--md"}):n.createElement("div",{className:"margin-top--md"},h.map(((e,t)=>(0,n.cloneElement)(e,{key:t,hidden:e.props.value!==P})))))}function m(e){const t=(0,o.Z)();return n.createElement(g,(0,s.Z)({key:String(t)},e))}},4042:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>u,contentTitle:()=>d,default:()=>c,frontMatter:()=>i,metadata:()=>p,toc:()=>g});var s=a(7462),n=(a(7294),a(3905)),l=a(5488),o=a(5162),r=a(6823);const i={title:"PostgresDB Installation",description:"Gyeeta PostgresDB Installation"},d="Gyeeta PostgresDB Installation",p={unversionedId:"installation/postgresdb_install",id:"installation/postgresdb_install",title:"PostgresDB Installation",description:"Gyeeta PostgresDB Installation",source:"@site/docs/installation/postgresdb_install.md",sourceDirName:"installation",slug:"/installation/postgresdb_install",permalink:"/docs/installation/postgresdb_install",draft:!1,editUrl:"https://github.com/gyeeta/gyeeta.github.io/tree/main/docs/installation/postgresdb_install.md",tags:[],version:"current",lastUpdatedAt:1668793594,formattedLastUpdatedAt:"Nov 18, 2022",frontMatter:{title:"PostgresDB Installation",description:"Gyeeta PostgresDB Installation"},sidebar:"docs",previous:{title:"TL;DR Quick Server Install",permalink:"/docs/installation/tldr_quick_install"},next:{title:"shyama Server Configuration",permalink:"/docs/installation/shyama_config"}},u={},g=[{value:"Shyama Postgres Disk Space Requirement",id:"shyama-dbspace",level:2},{value:"Madhava Postgres Disk Space Requirement",id:"madhava-dbspace",level:2},{value:"CPU and Memory Requirements for PostgresDB",id:"db-cpu-mem",level:2},{value:"Network Connectivity Requirements",id:"network",level:2},{value:"Installation Instructions",id:"installation-instructions",level:2},{value:"<em>Install using Shell script</em>",id:"shell-script",level:3},{value:"Stopping/Starting/Uninstalling the Postgres DB",id:"stoppingstartinguninstalling-the-postgres-db",level:4},{value:"<em>Running as a Docker container</em>",id:"docker",level:3},{value:"Run postgresdb DB init first (only once)",id:"run-postgresdb-db-init-first-only-once",level:4},{value:"Run postgresdb after init",id:"run-postgresdb-after-init",level:4},{value:"<em>Install using native rpm or deb packages</em>",id:"rpm-deb",level:3},{value:"PostgresDB Configuration post Installation",id:"postgresdb-configuration-post-installation",level:4},{value:"Stopping/Starting/Uninstalling the Postgres DB",id:"stoppingstartinguninstalling-the-postgres-db-1",level:4},{value:"<em>Manual Tar Package install</em>",id:"tar-install",level:3},{value:"Using a non Gyeeta based Postgres DB install",id:"using-a-non-gyeeta-based-postgres-db-install",level:2}],m={toc:g};function c(e){let{components:t,...a}=e;return(0,n.kt)("wrapper",(0,s.Z)({},m,a,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"gyeeta-postgresdb-installation"},"Gyeeta PostgresDB Installation"),(0,n.kt)("p",null,"Gyeeta Shyama and Madhava servers use PostgresDB as a data store."),(0,n.kt)("p",null,"A single instance of Postgres can support 1 Shyama server and upto 3 Madhava server instances."),(0,n.kt)("admonition",{type:"info"},(0,n.kt)("p",{parentName:"admonition"},"For Kubernetes Helm Charts based installs, Postgres does not need to be installed separately, as the PostgresDB\ncontainer is installed as a sidecar container automatically.")),(0,n.kt)("h2",{id:"shyama-dbspace"},"Shyama Postgres Disk Space Requirement"),(0,n.kt)("p",null,"The PostgresDB instance to be used by Shyama will need about 10 GB of disk space for a typical environment."),(0,n.kt)("h2",{id:"madhava-dbspace"},"Madhava Postgres Disk Space Requirement"),(0,n.kt)("p",null,"Maximum 3 instances of Madhava can share a single PostgresDB instance."),(0,n.kt)("p",null,"The PostgresDB instance to be used by each Madhava will need about 0.5 GB per day of free disk space per monitored host."),(0,n.kt)("p",null,"As an example, lets say there are 200 hosts to be monitored in total and maximum 3 days of statistics history is needed. "),(0,n.kt)("p",null,"This implies that an average of 200 x 0.5 x 3 = 300 GB of free disk space is needed for these 200 hosts."),(0,n.kt)("h2",{id:"db-cpu-mem"},"CPU and Memory Requirements for PostgresDB"),(0,n.kt)("p",null,"Shyama PostgresDB instances will need minimal CPU and Memory requirements :"),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"Max 10% of 1 core CPU and upto 512 MB RAM")),(0,n.kt)("p",null,"Madhava Postgres insatnces need more CPU and Memory requirements :"),(0,n.kt)("blockquote",null,(0,n.kt)("p",{parentName:"blockquote"},"Max 100% of 1 core CPU and memory ranging from 1 GB to 32 GB RAM depending on the number of hosts the Madhava instance handles")),(0,n.kt)("h2",{id:"network"},"Network Connectivity Requirements"),(0,n.kt)("p",null,"Network connectivity to the PostgresDB instance will need to be provided to the Shyama or Madhava instances using that DB. Firewall rules\nmust allow inbound access to the Postgres DB on the configured Postgres port (default port is 10040)."),(0,n.kt)("h2",{id:"installation-instructions"},"Installation Instructions"),(0,n.kt)("p",null,"Different Install Options exist :"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"#shellscript"},"Install using Shell Script")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"#docker"},"Running as a Docker container")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"#rpm-deb"},"Install using native rpm or deb packages")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"#tar-install"},"Manual Tar Package install"))),(0,n.kt)("p",null,"For Kubernetes, no separate Helm chart needs to be installed as Postgres is automatically installed along with Shyama and Madhava."),(0,n.kt)("h3",{id:"shell-script"},(0,n.kt)("em",{parentName:"h3"},"Install using Shell script")),(0,n.kt)("p",null,"Users can download a shell script that takes care of the installation and configuration of the PostgresDB instance."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"curl -o /tmp/install-gyeeta-postgresdb.sh -s https://gyeeta.io/packages/install-gyeeta-postgresdb.sh\n\n# Then run the install script as : \n# sudo bash /tmp/install-gyeeta-postgresdb.sh <Path to DB Data dir> <DB 'postgres' user Password> <Postgres Port to Listen on> <Optional DB Max Memory Shared buffers in MB>\n\n# The DB Data dir will be created if it does not exist. Please ensure that the DB Data dir has adequate Free Disk Space.\n\n# Example Command with gyeetadbPassword as the password :\n\nsudo bash /tmp/install-gyeeta-postgresdb.sh /opt/gyeeta/postgresdb/data gyeetadbPassword 10040\n\n")),(0,n.kt)("p",null,"The install script SHA256 can be checked before installing. The SHA256 of the install script is available at ",(0,n.kt)("a",{parentName:"p",href:"https://gyeeta.io/packages/install-gyeeta-postgresdb.sh.sum"},"SHA256 file")),(0,n.kt)("h4",{id:"stoppingstartinguninstalling-the-postgres-db"},"Stopping/Starting/Uninstalling the Postgres DB"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Command to stop the Postgres DB"',title:'"Command',to:!0,stop:!0,the:!0,Postgres:!0,'DB"':!0},"\nsudo systemctl stop gyeeta-postgresdb\n\n")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Command to start the Postgres DB"',title:'"Command',to:!0,start:!0,the:!0,Postgres:!0,'DB"':!0},"\nsudo systemctl start gyeeta-postgresdb\n\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Command to uninstall Gyeeta PostgresDB")),(0,n.kt)(l.Z,{mdxType:"Tabs"},(0,n.kt)(o.Z,{value:"UbuntuDebian",label:"Ubuntu / Debian",default:!0,mdxType:"TabItem"},(0,n.kt)(r.Z,{language:"sh",mdxType:"CodeBlock"},"sudo systemctl disable gyeeta-postgresdb; sudo apt-get remove gyeeta-postgresdb")),(0,n.kt)(o.Z,{value:"rhel",label:"RHEL / Rocky Linux / Amazon Linux",mdxType:"TabItem"},(0,n.kt)(r.Z,{language:"sh",mdxType:"CodeBlock"},"sudo systemctl disable gyeeta-postgresdb; sudo yum erase gyeeta-postgresdb")),(0,n.kt)(o.Z,{value:"suse",label:"SuSE / OpenSuSE",mdxType:"TabItem"},(0,n.kt)(r.Z,{language:"sh",mdxType:"CodeBlock"},"sudo systemctl disable gyeeta-postgresdb; sudo zypper remove gyeeta-postgresdb")),(0,n.kt)(o.Z,{value:"fedora",label:"Fedora Linux",mdxType:"TabItem"},(0,n.kt)(r.Z,{language:"sh",mdxType:"CodeBlock"},"sudo systemctl disable gyeeta-postgresdb; sudo dnf remove gyeeta-postgresdb"))),(0,n.kt)("h3",{id:"docker"},(0,n.kt)("em",{parentName:"h3"},"Running as a Docker container")),(0,n.kt)("p",null,"Running Postgres as a Docker container is a 2 step process. "),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"A one time DB init is needed."),(0,n.kt)("li",{parentName:"ol"},"Therafter, the DB docker container can be run multiple times.")),(0,n.kt)("p",null,"The docker container needs the following inputs :"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"A Volume mount dir for storing the DB data"),(0,n.kt)("li",{parentName:"ul"},"Init DB Password and Port number")),(0,n.kt)("p",null,"The docker container will only run under userid 1001 and groupid 1001. The volume mount dir needs to have its ownership\nchanged to userid:groupid as 1001:1001."),(0,n.kt)("h4",{id:"run-postgresdb-db-init-first-only-once"},"Run postgresdb DB init first (only once)"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Example Docker Init Command"',title:'"Example',Docker:!0,Init:!0,'Command"':!0},"\ndocker run -td --rm --name gyeetaInitPostgres --read-only --user 1001:1001 -v /opt/gyeeta/dbdata:/dbdata --env CFG_POSTGRES_PASSWORD=gyeetadbPassword --env CFG_POSTGRES_PORT=10040 ghcr.io/gyeeta/postgresdb --initdb\n\n")),(0,n.kt)("h4",{id:"run-postgresdb-after-init"},"Run postgresdb after init"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Example Docker Command After Init"',title:'"Example',Docker:!0,Command:!0,After:!0,'Init"':!0},"\ndocker run -td --rm --name gyeetaPostgres --read-only --user 1001:1001 -p 10040:10040 -v /opt/gyeeta/dbdata:/dbdata ghcr.io/gyeeta/postgresdb \n\n")),(0,n.kt)("h3",{id:"rpm-deb"},(0,n.kt)("em",{parentName:"h3"},"Install using native rpm or deb packages")),(0,n.kt)("p",null,"Gyeeta native rpm or deb packages are available. The install is to be followed by DB initialization and configuration."),(0,n.kt)(l.Z,{mdxType:"Tabs"},(0,n.kt)(o.Z,{value:"UbuntuDebian",label:"Ubuntu / Debian",default:!0,mdxType:"TabItem"},(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},'curl https://pkg.gyeeta.workers.dev/pgp-key.public | sudo gpg --yes --dearmor --output /usr/share/keyrings/gyeeta-keyring.gpg\necho "deb [arch=amd64 signed-by=/usr/share/keyrings/gyeeta-keyring.gpg] https://pkg.gyeeta.workers.dev/apt-repo stable main" | sudo tee /etc/apt/sources.list.d/gyeeta.list\nsudo apt-get update\nsudo apt-get install -y gyeeta-postgresdb\n'))),(0,n.kt)(o.Z,{value:"rhel",label:"RHEL / Rocky Linux / Amazon Linux",mdxType:"TabItem"},(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"sudo rpm --import https://pkg.gyeeta.workers.dev/pgp-key.public\nsudo curl -s -o /etc/yum.repos.d/gyeeta.repo https://pkg.gyeeta.workers.dev/rpm-repo/gyeeta.repo\nsudo yum -y update\nsudo yum install -y gyeeta-postgresdb\n"))),(0,n.kt)(o.Z,{value:"suse",label:"SuSE / OpenSuSE",mdxType:"TabItem"},(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"sudo rpm --import https://pkg.gyeeta.workers.dev/pgp-key.public\nsudo curl -s -o /etc/zypp/repos.d/gyeeta.repo https://pkg.gyeeta.workers.dev/rpm-repo/gyeeta.repo\nsudo zypper -q -n install gyeeta-postgresdb\n"))),(0,n.kt)(o.Z,{value:"fedora",label:"Fedora Linux",mdxType:"TabItem"},(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"sudo rpm --import https://pkg.gyeeta.workers.dev/pgp-key.public\nsudo curl -s -o /etc/yum.repos.d/gyeeta.repo https://pkg.gyeeta.workers.dev/rpm-repo/gyeeta.repo\nsudo dnf -y update\nsudo dnf install -y gyeeta-postgresdb\n")))),(0,n.kt)("h4",{id:"postgresdb-configuration-post-installation"},"PostgresDB Configuration post Installation"),(0,n.kt)("p",null,"After the deb or rpm package has been installed, a one time DB initialization is needed. The command to\nrun the init is :"),(0,n.kt)("p",null,(0,n.kt)("inlineCode",{parentName:"p"},"sudo -H -u gyeeta $INSTALLDIR/db_install.sh <DB Data directory path> <DB 'postgres' user Password> <Postgres Port to Listen on> <Optional DB Max Shared buffers in MB>")),(0,n.kt)("p",null,"The DB Data dir will be created if it does not exist. Please ensure that the DB Data dir has adequate Free Disk Space."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Example Configure Command"',title:'"Example',Configure:!0,'Command"':!0},"\nsudo -H -u gyeeta /opt/gyeeta/postgresdb/db_install.sh /opt/gyeeta/postgresdb/data gyeetadbPassword 10040\n\n# Thereafter start the gyeeta-postgresdb \nsudo systemctl start gyeeta-postgresdb\nsudo systemctl enable gyeeta-postgresdb\n\n")),(0,n.kt)("h4",{id:"stoppingstartinguninstalling-the-postgres-db-1"},"Stopping/Starting/Uninstalling the Postgres DB"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Command to stop the Postgres DB"',title:'"Command',to:!0,stop:!0,the:!0,Postgres:!0,'DB"':!0},"\nsudo systemctl stop gyeeta-postgresdb\n\n")),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Command to start the Postgres DB"',title:'"Command',to:!0,start:!0,the:!0,Postgres:!0,'DB"':!0},"\nsudo systemctl start gyeeta-postgresdb\n\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"Command to uninstall Gyeeta PostgresDB")),(0,n.kt)(l.Z,{mdxType:"Tabs"},(0,n.kt)(o.Z,{value:"UbuntuDebian",label:"Ubuntu / Debian",default:!0,mdxType:"TabItem"},(0,n.kt)(r.Z,{language:"sh",mdxType:"CodeBlock"},"sudo systemctl disable gyeeta-postgresdb; sudo apt-get remove gyeeta-postgresdb")),(0,n.kt)(o.Z,{value:"rhel",label:"RHEL / Rocky Linux / Amazon Linux",mdxType:"TabItem"},(0,n.kt)(r.Z,{language:"sh",mdxType:"CodeBlock"},"sudo systemctl disable gyeeta-postgresdb; sudo yum erase gyeeta-postgresdb")),(0,n.kt)(o.Z,{value:"suse",label:"SuSE / OpenSuSE",mdxType:"TabItem"},(0,n.kt)(r.Z,{language:"sh",mdxType:"CodeBlock"},"sudo systemctl disable gyeeta-postgresdb; sudo zypper remove gyeeta-postgresdb")),(0,n.kt)(o.Z,{value:"fedora",label:"Fedora Linux",mdxType:"TabItem"},(0,n.kt)(r.Z,{language:"sh",mdxType:"CodeBlock"},"sudo systemctl disable gyeeta-postgresdb; sudo dnf remove gyeeta-postgresdb"))),(0,n.kt)("h3",{id:"tar-install"},(0,n.kt)("em",{parentName:"h3"},"Manual Tar Package install")),(0,n.kt)("p",null,"If none of the above options can be used to install the Gyeeta PostgresDB component, a manual tarball extract and configure\ncan be used to install."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Example Install Command"',title:'"Example',Install:!0,'Command"':!0},"\nmkdir ~/gyeeta\ncd ~/gyeeta\ncurl -L https://github.com/gyeeta/postgresdb/releases/download/$( curl https://api.github.com/repos/gyeeta/postgresdb/releases/latest -s | grep tag_name | awk -F\\\" '{print $4}' )/postgresdb.tar.gz | tar xzf -\ncd ./postgresdb\n\n# Thereafter configure the DB\n# ./db_install.sh <DB Data directory> <DB 'postgres' user password> <Postgres Port to Listen on> <Optional DB Max Shared buffers in MB>\n\n./db_install.sh ./data dbPassword 10040\n\n# Then start the DB\n./rundb.sh start\n\n")),(0,n.kt)("h2",{id:"using-a-non-gyeeta-based-postgres-db-install"},"Using a non Gyeeta based Postgres DB install"),(0,n.kt)("p",null,"We recommend only using Gyeeta's Postgres DB as the Gyeeta Postgres install also includes various utilities and functions needed by\nthe Madhava and Shyama servers. "),(0,n.kt)("p",null,"Using other Postgres installs or Postgres compliant DBs is currently not supported."))}c.isMDXComponent=!0}}]);